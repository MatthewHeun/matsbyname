<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="matsbyname">
<title>About Vector Arguments • matsbyname</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="About Vector Arguments">
<meta property="og:description" content="matsbyname">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">matsbyname</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/matsbyname.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/about-vector-arguments.html">About Vector Arguments</a>
    <a class="dropdown-item" href="../articles/aggregation-vignette.html">Aggregation in `matsbyname`</a>
    <a class="dropdown-item" href="../articles/applybyname-vignette.html">Writing Custom Functions for `matsbyname`</a>
    <a class="dropdown-item" href="../articles/using-summarise-in-matsbyname.html">Using summarise in matsbyname</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MatthewHeun/matsbyname/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>About Vector Arguments</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MatthewHeun/matsbyname/blob/HEAD/vignettes/about-vector-arguments.Rmd" class="external-link"><code>vignettes/about-vector-arguments.Rmd</code></a></small>
      <div class="d-none name"><code>about-vector-arguments.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>*apply_byname()</code> family of functions are used
internally by many functions in <code>matsbyname</code>. These functions
(<code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code>, <code><a href="../reference/binaryapply_byname.html">binaryapply_byname()</a></code>,
<code><a href="../reference/naryapply_byname.html">naryapply_byname()</a></code>) allow additional arguments, besides the
matrices that are being transformed, which are passed via
<code>.FUNdots</code>. Getting <code>.FUNdots</code> right can be
challenging, and this vignette provides some background and explanation
to those challenges. After reading this vignette, both callers of these
functions and programmers who use these functions will be in a better
position to take advantage of the various <code>*apply_byname()</code>
functions.</p>
</div>
<div class="section level2">
<h2 id="an-example">An example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h2>
<p>To see how the <code>.FUNdots</code> argument works, let’s make an
example function that takes advantage of
<code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code>. <code>mysum()</code> adds entries in
matrix <code>a</code>, the result depending upon the value of
<code>margin</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mysum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">margin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sum_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a_mat</span>, <span class="va">margin</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># When we get here, we will have a single matrix a</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fl">1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">margin</span> <span class="op">&amp;</span> <span class="fl">2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">margin</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">margin</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">margin</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="../reference/unaryapply_byname.html">unaryapply_byname</a></span><span class="op">(</span><span class="va">sum_func</span>, <span class="va">a</span>, .FUNdots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="va">margin</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Structuring <code>mysum()</code> as shown above provides several
interesting capabilities. First, <code>mysum()</code> works with single
matrices.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">m</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    1    2</span></span>
<span><span class="co">#&gt; [2,]    3    4</span></span>
<span><span class="co"># Works for single matrices</span></span>
<span><span class="fu">mysum</span><span class="op">(</span><span class="va">m</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="fu">mysum</span><span class="op">(</span><span class="va">m</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span>
<span><span class="fu">mysum</span><span class="op">(</span><span class="va">m</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>Second, <code>mysum()</code> works with lists.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Works for lists of matrices</span></span>
<span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>one <span class="op">=</span> <span class="va">m</span>, two <span class="op">=</span> <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $one</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $two</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>one <span class="op">=</span> <span class="va">m</span>, two <span class="op">=</span> <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; $one</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $two</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span></code></pre></div>
<p>Finally, <code>mysum()</code> works within data frames.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Works in data frames and tibbles</span></span>
<span><span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>mcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">DF</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    rsums <span class="op">=</span> <span class="fu">mysum</span><span class="op">(</span><span class="va">mcol</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>    csums <span class="op">=</span> <span class="fu">mysum</span><span class="op">(</span><span class="va">mcol</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">rsums</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">csums</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-problem">The problem<a class="anchor" aria-label="anchor" href="#the-problem"></a>
</h2>
<p>In the above examples, <code>margin</code> was only <code>1</code> or
<code>2</code>, not <code>c(1, 2)</code> for the list and data frame
examples. Let’s see what happens when <code>margin = c(1, 2)</code> and
<code>a</code> is a list.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="va">e</span>, width <span class="op">=</span> <span class="fl">60</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Error: In prepare_.FUNdots(), when 'a' is a list, but an"   </span></span>
<span><span class="co">#&gt; [2] "entry in '.FUNdots' is not a list, every top-level argument"</span></span>
<span><span class="co">#&gt; [3] "in .FUNdots must be NULL or have length = 1 or length ="    </span></span>
<span><span class="co">#&gt; [4] "length(a) (= 3). Found length = 2 for argument 'margin',"   </span></span>
<span><span class="co">#&gt; [5] "which is not a list. Consider converting argument 'margin'" </span></span>
<span><span class="co">#&gt; [6] "into a list of length 1."</span></span></code></pre></div>
<p>To understand better what is happening, let’s try when the list
argument to <code>mysum()</code> has length <code>2</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span></code></pre></div>
<p><code>margin = c(1, 2)</code> is interpreted by
<code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code> as “use <code>margin = 1</code> for the
first <code>m</code> in the list, and use <code>margin = 2</code> for
the second <code>m</code> in the list.</p>
<p>Now we see why passing <code>margin = c(1, 2)</code> failed for a
list of length <code>3</code> (<code>list(m, m, m)</code>):
<code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code> applied <code>margin = 1</code> for the
first <code>m</code>, <code>margin = 2</code> for the second
<code>m</code>. But the third <code>m</code> had no margin available for
it.</p>
<p>We also see why passing <code>margin = c(1, 2)</code> was successful
for a list of length <code>2</code> (<code>list(m, m)</code>):
<code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code> applied <code>margin = 1</code> for the
first <code>m</code>, <code>margin = 2</code> for the second
<code>m</code>. In that case, we had exactly as many items in margin (2)
as items in the list passed to <code>a</code> (2).</p>
<p>Now that we understand the problem, how do we fix it? In other words,
how can we apply <code>margin = c(1, 2)</code> to all entries in
<code>list(m, m, m)</code>? Or, better yet, how could we apply
<code>margin = 1</code> to the first <code>m</code>,
<code>margin = 2</code> to the second <code>m</code>, and
<code>margin = c(1, 2)</code> to the third <code>m</code>?</p>
</div>
<div class="section level2">
<h2 id="the-fix">The fix<a class="anchor" aria-label="anchor" href="#the-fix"></a>
</h2>
<p>Fixes to the problem identified above can be provided by either the
caller or (partially) by the programmer in three ways:</p>
<ul>
<li>wrap vector arguments in a list (a caller fix),</li>
<li>use the <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> function (a programmer fix),
and</li>
<li>use a data frame (a caller fix).</li>
</ul>
<div class="section level3">
<h3 id="wrap-vector-arguments-in-a-list">Wrap vector arguments in a list<a class="anchor" aria-label="anchor" href="#wrap-vector-arguments-in-a-list"></a>
</h3>
<p>If the caller is more specific, flexibility is gained. By wrapping
<code>c(1, 2)</code> in a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>, the caller indicates
“Take this margin (<code>c(1, 2)</code>), replicate it as many times as
we have items in our <code>a</code> list, using one <code>c(1, 2)</code>
for each item in the list.”</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>The caller can also supply different <code>margin</code>s for each
item in the list of matrices.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>But the caller must provide either <code>1</code> or
<code>length(a)</code> items in the <code>margin</code> argument, else
an error is emitted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="va">e</span>, width <span class="op">=</span> <span class="fl">60</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Error: In prepare_.FUNdots(), when both 'a' and '.FUNdots'"</span></span>
<span><span class="co">#&gt; [2] "are lists, each top-level argument in .FUNdots must have"  </span></span>
<span><span class="co">#&gt; [3] "length = 1 or length = length(a) (= 3). Found length = 2"  </span></span>
<span><span class="co">#&gt; [4] "for argument 'margin', which is a list. Consider wrapping" </span></span>
<span><span class="co">#&gt; [5] "argument 'margin' in a list()."</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-the-prep_vector_arg-function">Use the <code>prep_vector_arg()</code> function<a class="anchor" aria-label="anchor" href="#use-the-prep_vector_arg-function"></a>
</h3>
<p>To the extent possible, programmers should remove burdens on users of
their functions. So, it would be helpful if there were a way to
automatically wrap vector arguments in lists. To that end,
<code>matsbyname</code> includes the <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code>
function. <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> uses heuristics to wrap vector
arguments in lists, if needed and when possible.</p>
<p><code>mysum2()</code> demonstrates the use of
<code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mysum2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">margin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">margin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_vector_arg.html">prep_vector_arg</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">margin</span><span class="op">)</span></span>
<span>  <span class="va">sum_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a_mat</span>, <span class="va">margin</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># When we get here, we will have a single matrix a</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fl">1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">margin</span> <span class="op">&amp;</span> <span class="fl">2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">margin</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">margin</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">margin</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="../reference/unaryapply_byname.html">unaryapply_byname</a></span><span class="op">(</span><span class="va">sum_func</span>, <span class="va">a</span>, .FUNdots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="va">margin</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If</p>
<ul>
<li>argument <code>a</code> is a list,</li>
<li>the vector argument (in this case <code>margin</code>) is not a
list, and</li>
<li>the vector argument’s length is greater than 1 but not equal to the
length of a,</li>
</ul>
<p>then <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> wraps the vector argument (in
this case <code>margin</code>) in a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>, thereby
relieving the caller of having to remember to make it into a
<code>list</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mysum2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>Note that if the length of the vector argument is equal to the length
of the list in <code>a</code>, the caller’s intention is ambiguous, and
the vector argument is passed without modification.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mysum2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span></code></pre></div>
<p>If the caller wants <code>c(1, 2)</code> to be applied to each item
in the <code>a</code> list, the caller must wrap <code>c(1, 2)</code> in
a list.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mysum2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-a-data-frame">Use a data frame<a class="anchor" aria-label="anchor" href="#use-a-data-frame"></a>
</h3>
<p>The reason <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> cannot <em>always</em> wrap
vector arguments in a list is that data frame columns are extracted as
vectors when they are atomic.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DF2</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>mcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DF2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   mcol          margin</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;int [2 × 2]&gt;</span>      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;int [2 × 2]&gt;</span>      2</span></span>
<span><span class="va">DF2</span><span class="op">$</span><span class="va">margin</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "numeric"</span></span></code></pre></div>
<p>It would be a mistake to wrap <code>DF2$margin</code> in a
<code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> for the following call to <code>mysum2</code>,
because the caller’s intent is clearly “apply <code>margin = 1</code>
for the first row and <code>margin = 2</code> for the second row.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="va">DF2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    sums <span class="op">=</span> <span class="fu">mysum2</span><span class="op">(</span><span class="va">mcol</span>, margin <span class="op">=</span> <span class="va">margin</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">res2</span><span class="op">$</span><span class="va">sums</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    4    6</span></span></code></pre></div>
<p>The good news is that within the context of a data frame, the
caller’s intent is unambiguous.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DF3</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>mcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    sumcol <span class="op">=</span> <span class="fu">mysum2</span><span class="op">(</span><span class="va">mcol</span>, margin <span class="op">=</span> <span class="va">margin</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">DF3</span><span class="op">$</span><span class="va">sumcol</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]    3</span></span>
<span><span class="co">#&gt; [2,]    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Dealing with vector arguments to the various
<code>*apply_byname()</code> functions can be tricky. But there are
three ways to solve any problems that arise:</p>
<ul>
<li>wrap vector arguments in a list (a caller fix),</li>
<li>use the <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> function (a programmer fix),
and</li>
<li>use a data frame (a caller fix).</li>
</ul>
<p>This vignette illustrated all three fixes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew Heun.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
