<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>About Vector Arguments • matsbyname</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="About Vector Arguments">
<meta property="og:description" content="matsbyname">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">matsbyname</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.25</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/matsbyname.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/about-vector-arguments.html">About Vector Arguments</a>
    </li>
    <li>
      <a href="../articles/applybyname-vignette.html">Writing Custom Functions for `matsbyname`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MatthewHeun/matsbyname/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>About Vector Arguments</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MatthewHeun/matsbyname/blob/HEAD/vignettes/about-vector-arguments.Rmd" class="external-link"><code>vignettes/about-vector-arguments.Rmd</code></a></small>
      <div class="hidden name"><code>about-vector-arguments.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>*apply_byname()</code> family of functions are used internally by many functions in <code>matsbyname</code>. These functions (<code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code>, <code><a href="../reference/binaryapply_byname.html">binaryapply_byname()</a></code>, <code><a href="../reference/naryapply_byname.html">naryapply_byname()</a></code>) allow additional arguments, besides the matrices that are being transformed, which are passed via <code>.FUNdots</code>. Getting <code>.FUNdots</code> right can be challenging, and this vignette provides some background and explanation to those challenges. After reading this vignette, both callers of these functions and programmers who use these functions will be in a better position to take advantage of the various <code>*apply_byname()</code> functions.</p>
</div>
<div class="section level2">
<h2 id="an-example">An example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h2>
<p>To see how the <code>.FUNdots</code> argument works, let’s make an example function that takes advantage of <code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code>. <code>mysum()</code> adds entries in matrix <code>a</code>, the result depending upon the value of <code>margin</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mysum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">margin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sum_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a_mat</span>, <span class="va">margin</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># When we get here, we will have a single matrix a</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fl">1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">margin</span> <span class="op">&amp;</span> <span class="fl">2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">margin</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">margin</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">margin</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="fu"><a href="../reference/unaryapply_byname.html">unaryapply_byname</a></span><span class="op">(</span><span class="va">sum_func</span>, <span class="va">a</span>, .FUNdots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="va">margin</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Structuring <code>mysum()</code> as shown above provides several interesting capabilities. First, <code>mysum()</code> works with single matrices.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">m</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    1    2</span>
<span class="co">#&gt; [2,]    3    4</span>
<span class="co"># Works for single matrices</span>
<span class="fu">mysum</span><span class="op">(</span><span class="va">m</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="fu">mysum</span><span class="op">(</span><span class="va">m</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span>
<span class="fu">mysum</span><span class="op">(</span><span class="va">m</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
<p>Second, <code>mysum()</code> works with lists.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Works for lists of matrices</span>
<span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>one <span class="op">=</span> <span class="va">m</span>, two <span class="op">=</span> <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; $one</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $two</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>one <span class="op">=</span> <span class="va">m</span>, two <span class="op">=</span> <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; $one</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $two</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span></code></pre></div>
<p>Finally, <code>mysum()</code> works within data frames.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Works in data frames and tibbles</span>
<span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>mcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="va">DF</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    rsums <span class="op">=</span> <span class="fu">mysum</span><span class="op">(</span><span class="va">mcol</span>, margin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, 
    csums <span class="op">=</span> <span class="fu">mysum</span><span class="op">(</span><span class="va">mcol</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">res</span><span class="op">$</span><span class="va">rsums</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="va">res</span><span class="op">$</span><span class="va">csums</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-problem">The problem<a class="anchor" aria-label="anchor" href="#the-problem"></a>
</h2>
<p>In the above examples, <code>margin</code> was only <code>1</code> or <code>2</code>, not <code>c(1, 2)</code> for the list and data frame examples. Let’s see what happens when <code>margin = c(1, 2)</code> and <code>a</code> is a list.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, 
         error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="va">e</span>, width <span class="op">=</span> <span class="fl">60</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; [1] "Error: In prepare_.FUNdots(), when 'a' is a list, but an"   </span>
<span class="co">#&gt; [2] "entry in '.FUNdots' is not a list, every top-level argument"</span>
<span class="co">#&gt; [3] "in .FUNdots must be NULL or have length = 1 or length ="    </span>
<span class="co">#&gt; [4] "length(a) (= 3). Found length = 2 for argument 'margin',"   </span>
<span class="co">#&gt; [5] "which is not a list. Consider converting argument 'margin'" </span>
<span class="co">#&gt; [6] "into a list of length 1."</span></code></pre></div>
<p>To understand better what is happening, let’s try when the list argument to <code>mysum()</code> has length <code>2</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span></code></pre></div>
<p><code>margin = c(1, 2)</code> is interpreted by <code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code> as “use <code>margin = 1</code> for the first <code>m</code> in the list, and use <code>margin = 2</code> for the second <code>m</code> in the list.</p>
<p>Now we see why passing <code>margin = c(1, 2)</code> failed for a list of length <code>3</code> (<code>list(m, m, m)</code>): <code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code> applied <code>margin = 1</code> for the first <code>m</code>, <code>margin = 2</code> for the second <code>m</code>. But the third <code>m</code> had no margin available for it.</p>
<p>We also see why passing <code>margin = c(1, 2)</code> was successful for a list of length <code>2</code> (<code>list(m, m)</code>): <code><a href="../reference/unaryapply_byname.html">unaryapply_byname()</a></code> applied <code>margin = 1</code> for the first <code>m</code>, <code>margin = 2</code> for the second <code>m</code>. In that case, we had exactly as many items in margin (2) as items in the list passed to <code>a</code> (2).</p>
<p>Now that we understand the problem, how do we fix it? In other words, how can we apply <code>margin = c(1, 2)</code> to all entries in <code>list(m, m, m)</code>? Or, better yet, how could we apply <code>margin = 1</code> to the first <code>m</code>, <code>margin = 2</code> to the second <code>m</code>, and <code>margin = c(1, 2)</code> to the third <code>m</code>?</p>
</div>
<div class="section level2">
<h2 id="the-fix">The fix<a class="anchor" aria-label="anchor" href="#the-fix"></a>
</h2>
<p>Fixes to the problem identified above can be provided by either the caller or (partially) by the programmer in three ways:</p>
<ul>
<li>wrap vector arguments in a list (a caller fix),</li>
<li>use the <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> function (a programmer fix), and</li>
<li>use a data frame (a caller fix).</li>
</ul>
<div class="section level3">
<h3 id="wrap-vector-arguments-in-a-list">Wrap vector arguments in a list<a class="anchor" aria-label="anchor" href="#wrap-vector-arguments-in-a-list"></a>
</h3>
<p>If the caller is more specific, flexibility is gained. By wrapping <code>c(1, 2)</code> in a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>, the caller indicates “Take this margin (<code>c(1, 2)</code>), replicate it as many times as we have items in our <code>a</code> list, using one <code>c(1, 2)</code> for each item in the list.”</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
<p>The caller can also supply different <code>margin</code>s for each item in the list of matrices.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
<p>But the caller must provide either <code>1</code> or <code>length(a)</code> items in the <code>margin</code> argument, else an error is emitted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu">mysum</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, 
         error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="va">e</span>, width <span class="op">=</span> <span class="fl">60</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; [1] "Error: In prepare_.FUNdots(), when both 'a' and '.FUNdots'"</span>
<span class="co">#&gt; [2] "are lists, each top-level argument in .FUNdots must have"  </span>
<span class="co">#&gt; [3] "length = 1 or length = length(a) (= 3). Found length = 2"  </span>
<span class="co">#&gt; [4] "for argument 'margin', which is a list. Consider wrapping" </span>
<span class="co">#&gt; [5] "argument 'margin' in a list()."</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-the-prep_vector_arg-function">Use the <code>prep_vector_arg()</code> function<a class="anchor" aria-label="anchor" href="#use-the-prep_vector_arg-function"></a>
</h3>
<p>To the extent possible, programmers should remove burdens on users of their functions. So, it would be helpful if there were a way to automatically wrap vector arguments in lists. To that end, <code>matsbyname</code> includes the <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> function. <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> uses heuristics to wrap vector arguments in lists, if needed and when possible.</p>
<p><code>mysum2()</code> demonstrates the use of <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mysum2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">margin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">margin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_vector_arg.html">prep_vector_arg</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">margin</span><span class="op">)</span>
  <span class="va">sum_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a_mat</span>, <span class="va">margin</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># When we get here, we will have a single matrix a</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fl">1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">margin</span> <span class="op">&amp;</span> <span class="fl">2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">margin</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">margin</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">margin</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">a_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="fu"><a href="../reference/unaryapply_byname.html">unaryapply_byname</a></span><span class="op">(</span><span class="va">sum_func</span>, <span class="va">a</span>, .FUNdots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="va">margin</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>If</p>
<ul>
<li>argument <code>a</code> is a list,</li>
<li>the vector argument (in this case <code>margin</code>) is not a list, and</li>
<li>the vector argument’s length is greater than 1 but not equal to the length of a,</li>
</ul>
<p>then <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> wraps the vector argument (in this case <code>margin</code>) in a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>, thereby relieving the caller of having to remember to make it into a <code>list</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mysum2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
<p>Note that if the length of the vector argument is equal to the length of the list in <code>a</code>, the caller’s intention is ambiguous, and the vector argument is passed without modification.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mysum2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span></code></pre></div>
<p>If the caller wants <code>c(1, 2)</code> to be applied to each item in the <code>a</code> list, the caller must wrap <code>c(1, 2)</code> in a list.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mysum2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-a-data-frame">Use a data frame<a class="anchor" aria-label="anchor" href="#use-a-data-frame"></a>
</h3>
<p>The reason <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> cannot <em>always</em> wrap vector arguments in a list is that data frame columns are extracted as vectors when they are atomic.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DF2</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>mcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">DF2</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span>
<span class="co">#&gt;   mcol          margin</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;int [2 × 2]&gt;</span>      1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;int [2 × 2]&gt;</span>      2</span>
<span class="va">DF2</span><span class="op">$</span><span class="va">margin</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "numeric"</span></code></pre></div>
<p>It would be a mistake to wrap <code>DF2$margin</code> in a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> for the following call to <code>mysum2</code>, because the caller’s intent is clearly “apply <code>margin = 1</code> for the first row and <code>margin = 2</code> for the second row.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res2</span> <span class="op">&lt;-</span> <span class="va">DF2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    sums <span class="op">=</span> <span class="fu">mysum2</span><span class="op">(</span><span class="va">mcol</span>, margin <span class="op">=</span> <span class="va">margin</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">res2</span><span class="op">$</span><span class="va">sums</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    4    6</span></code></pre></div>
<p>The good news is that within the context of a data frame, the caller’s intent is unambiguous.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DF3</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>mcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m</span>, <span class="va">m</span><span class="op">)</span>, margin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    sumcol <span class="op">=</span> <span class="fu">mysum2</span><span class="op">(</span><span class="va">mcol</span>, margin <span class="op">=</span> <span class="va">margin</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">DF3</span><span class="op">$</span><span class="va">sumcol</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;      [,1]</span>
<span class="co">#&gt; [1,]    3</span>
<span class="co">#&gt; [2,]    7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Dealing with vector arguments to the various <code>*apply_byname()</code> functions can be tricky. But there are three ways to solve any problems that arise:</p>
<ul>
<li>wrap vector arguments in a list (a caller fix),</li>
<li>use the <code><a href="../reference/prep_vector_arg.html">prep_vector_arg()</a></code> function (a programmer fix), and</li>
<li>use a data frame (a caller fix).</li>
</ul>
<p>This vignette illustrated all three fixes.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matthew Heun.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
