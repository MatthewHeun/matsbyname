<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Matthew Kuperus Heun" />

<meta name="date" content="2023-09-16" />

<title>Aggregation in matsbyname</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Aggregation in <code>matsbyname</code></h1>
<h4 class="author">Matthew Kuperus Heun</h4>
<h4 class="date">2023-09-16</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The <code>matsbyname</code> package provides several functions to
assist renaming and aggregating rows and columns of matrices. This
vignette shows how to use those functions.</p>
</div>
<div id="aggregate_byname" class="section level2">
<h2><code>aggregate_byname()</code></h2>
<p>By default
(<code>aggregation_map = NULL, margin = c(1,2), pattern_type = &quot;exact&quot;</code>),
<code>aggregate_byname()</code> sums all rows and columns with the same
names, with the effect that remaining row and column names are
unique.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, </span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>              <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>              <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;duck&quot;</span>, <span class="st">&quot;duck&quot;</span>, <span class="st">&quot;goose&quot;</span>), </span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;George&quot;</span>, <span class="st">&quot;Ringo&quot;</span>)))</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>m</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt;       John Paul George Ringo</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; duck     1    2      3     4</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; duck     5    6      7     8</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt; goose    9   10     11    12</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">aggregate_byname</span>(m)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt;       George John Paul Ringo</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt; duck      10    6    8    12</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; goose     11    9   10    12</span></span></code></pre></div>
<p>An <code>aggregation_map</code> can be provided, giving instructions
for rows or columns to aggregate and the names of the results.
<code>aggregation_map</code> should be a list of named strings. The
entries in the list give names of rows and columns to be aggregated. The
names of the list entries provide the names of the resulting
aggregates.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>m</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt;       John Paul George Ringo</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; duck     1    2      3     4</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; duck     5    6      7     8</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; goose    9   10     11    12</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">aggregate_byname</span>(m, <span class="at">aggregation_map =</span> <span class="fu">list</span>(<span class="at">birds =</span> <span class="fu">c</span>(<span class="st">&quot;duck&quot;</span>, <span class="st">&quot;goose&quot;</span>), </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>                                           <span class="at">guitarists =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;George&quot;</span>)))</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;       Ringo guitarists</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; birds    24         54</span></span></code></pre></div>
<p>The margin over which the aggregation is to be performed is given by
the <code>margin</code> argument (<code>1</code> for rows,
<code>2</code> for columns).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>m</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt;       John Paul George Ringo</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; duck     1    2      3     4</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; duck     5    6      7     8</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; goose    9   10     11    12</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">aggregate_byname</span>(m, <span class="at">aggregation_map =</span> <span class="fu">list</span>(<span class="at">Beatles =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;George&quot;</span>, <span class="st">&quot;Ringo&quot;</span>)), </span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                 <span class="at">margin =</span> <span class="dv">2</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt;       Beatles</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; duck       10</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; duck       26</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; goose      42</span></span></code></pre></div>
<p><code>aggregation_map</code> can use regular expressions to identify
rows and columns to aggregate. Use <code>pattern_type = &quot;literal&quot;</code>
for this feature.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>m</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt;       John Paul George Ringo</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; duck     1    2      3     4</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; duck     5    6      7     8</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; goose    9   10     11    12</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="fu">aggregate_byname</span>(m, <span class="at">aggregation_map =</span> <span class="fu">list</span>(<span class="at">guitarists =</span> <span class="st">&quot;^[JPG]&quot;</span>), </span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>                 <span class="at">margin =</span> <span class="dv">2</span>, <span class="at">pattern_type =</span> <span class="st">&quot;literal&quot;</span>)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;       Ringo guitarists</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; duck      4          6</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; duck      8         18</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; goose    12         30</span></span></code></pre></div>
<p>Note that rows and columns of aggregated matrices are always sorted
alphabetically.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>m</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt;       John Paul George Ringo</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; duck     1    2      3     4</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; duck     5    6      7     8</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; goose    9   10     11    12</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="fu">aggregate_byname</span>(m, <span class="at">aggregation_map =</span> <span class="fu">list</span>(<span class="at">birds =</span> <span class="fu">c</span>(<span class="st">&quot;duck&quot;</span>, <span class="st">&quot;goose&quot;</span>), </span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>                                           <span class="at">zguitarists =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;George&quot;</span>)))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt;       Ringo zguitarists</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; birds    24          54</span></span></code></pre></div>
<p>It is an error to aggregate over a margin and leave identically named
rows or columns. The following function call will fail, because it
aggregates over both rows and columns (using the default
<code>margin = c(1,2)</code>) with nothing in the
<code>aggregation_map</code> to aggregate the two “duck” rows. The error
is informative: “Row names not unique. Duplicated row names are:
duck”.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Not run</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">aggregate_byname</span>(m, <span class="at">aggregation_map =</span> <span class="fu">list</span>(<span class="at">Beatles =</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;George&quot;</span>, <span class="st">&quot;Ringo&quot;</span>)))</span></code></pre></div>
</div>
<div id="pieces" class="section level2">
<h2>Pieces</h2>
<p>Commonly, row and column names are complex, carrying information in
prefixes, suffixes, and prepositional phrases. <code>matsbyname</code>
can aggregate by pieces of a name, using the <code>RCLabels</code>
package internally.</p>
<p>We’ll use the following matrix to demonstrate aggregating by pieces.
The rows and columns use different notations for names
(<code>RCLabels::bracket_notation</code> for rows and
<code>RCLabels::arrow_notation</code> for columns). The renaming and
aggregation capabilities of <code>matsbyname</code> still work, despite
the different notations.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>m_pieces <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>                     <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                   <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Electricity [from Coal]&quot;</span>, <span class="st">&quot;Electricity [from Solar]&quot;</span>), </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="st">&quot;Motors -&gt; MD&quot;</span>, <span class="st">&quot;Cars -&gt; MD&quot;</span>, <span class="st">&quot;LED lamps -&gt; Light&quot;</span>)))</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>m_pieces</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt;                          Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]             1          2                  3</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]            4          5                  6</span></span></code></pre></div>
</div>
<div id="rename_to_piece_byname" class="section level2">
<h2><code>rename_to_piece_byname()</code></h2>
<p>Rows and columns can be renamed to their prefixes, suffixes, or
objects of prepositions, as demonstrated below.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>m_pieces</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt;                          Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]             1          2                  3</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]            4          5                  6</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;pref&quot;</span>, <span class="at">margin =</span> <span class="dv">1</span>, </span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                       <span class="at">notation =</span> RCLabels<span class="sc">::</span>bracket_notation)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;             Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; Electricity            1          2                  3</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; Electricity            4          5                  6</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>, <span class="at">margin =</span> <span class="dv">1</span>, </span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>                       <span class="at">notation =</span> RCLabels<span class="sc">::</span>bracket_notation)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;            Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; from Coal             1          2                  3</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; from Solar            4          5                  6</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;from&quot;</span>, <span class="at">margin =</span> <span class="dv">1</span>, </span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>                       <span class="at">notation =</span> RCLabels<span class="sc">::</span>bracket_notation)</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt;       Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; Coal             1          2                  3</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt; Solar            4          5                  6</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;pref&quot;</span>, <span class="at">margin =</span> <span class="dv">2</span>,</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>                       <span class="at">notation =</span> RCLabels<span class="sc">::</span>arrow_notation)</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt;                          Motors Cars LED lamps</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]       1    2         3</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]      4    5         6</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>, <span class="at">margin =</span> <span class="dv">2</span>,</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>                       <span class="at">notation =</span> RCLabels<span class="sc">::</span>arrow_notation)</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt;                          MD MD Light</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]   1  2     3</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]  4  5     6</span></span></code></pre></div>
<p>In the examples above, renaming was accomplished by specifying the
<code>notation</code> for row or column names. But notation for row and
column labels can also be inferred via
<code>RCLabels::infer_notation()</code>. To infer notation when
renaming, set <code>inf_notation = TRUE</code> (the default) and give a
list of notations from which the notation can be inferred in the
<code>notation</code> argument. By default,
<code>notation = list(RCLabels::notations_list)</code>, because each
notation in <code>RCLabels::notations_list</code> is a list itself.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>m_pieces</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt;                          Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]             1          2                  3</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]            4          5                  6</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;pref&quot;</span>, <span class="at">margin =</span> <span class="dv">1</span>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt;             Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; Electricity            1          2                  3</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; Electricity            4          5                  6</span></span></code></pre></div>
<p>When inferring notation, both margins can be renamed at the same
time, despite having different notations.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;pref&quot;</span>, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt;             Motors Cars LED lamps</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; Electricity      1    2         3</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; Electricity      4    5         6</span></span></code></pre></div>
<p>But <code>margin = list(c(1, 2))</code> is the default, so the code
can be simpler still.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;pref&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt;             Motors Cars LED lamps</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; Electricity      1    2         3</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; Electricity      4    5         6</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;            MD MD Light</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; from Coal   1  2     3</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; from Solar  4  5     6</span></span></code></pre></div>
<p>Sometimes, a row or column label can match more than one possible
<code>notation</code>. In the above example, the row names are inferred
to conform to <code>RCLabels::bracket_notation</code>, the first match
in <code>RCLabels::notations_list</code>.<br />
To specify the most-specific notation, set
<code>choose_most_specific = TRUE</code>. With
<code>choose_most_specific = TRUE</code>,
<code>RCLabels::from_notation</code> is inferred, the suffixes are
different, and the renamed rows no longer contain “from”.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>, <span class="at">choose_most_specific =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt;       MD MD Light</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; Coal   1  2     3</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; Solar  4  5     6</span></span></code></pre></div>
<p>Note that “noun” is a synonym for “pref”.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">rename_to_piece_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;noun&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt;             Motors Cars LED lamps</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; Electricity      1    2         3</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; Electricity      4    5         6</span></span></code></pre></div>
<p>The margin can be specified using row or column types from which the
numerical margin is inferred.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>m_pieces_with_types <span class="ot">&lt;-</span> m_pieces <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">setrowtype</span>(<span class="st">&quot;Product&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">setcoltype</span>(<span class="st">&quot;Industry&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>m_pieces_with_types</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt;                          Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]             1          2                  3</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]            4          5                  6</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;rowtype&quot;)</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Product&quot;</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;coltype&quot;)</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Industry&quot;</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>m_pieces_with_types <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  <span class="fu">rename_to_piece_byname</span>(<span class="at">piece =</span> <span class="st">&quot;pref&quot;</span>, <span class="at">margin =</span> <span class="st">&quot;Product&quot;</span>)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt;             Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; Electricity            1          2                  3</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt; Electricity            4          5                  6</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;rowtype&quot;)</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Product&quot;</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;coltype&quot;)</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Industry&quot;</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>m_pieces_with_types <span class="sc">%&gt;%</span> </span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>  <span class="fu">rename_to_piece_byname</span>(<span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>, <span class="at">margin =</span> <span class="st">&quot;Product&quot;</span>)</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="co">#&gt;            Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="co">#&gt; from Coal             1          2                  3</span></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="co">#&gt; from Solar            4          5                  6</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;rowtype&quot;)</span></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Product&quot;</span></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;coltype&quot;)</span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Industry&quot;</span></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>m_pieces_with_types <span class="sc">%&gt;%</span> </span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>  <span class="fu">rename_to_piece_byname</span>(<span class="at">piece =</span> <span class="st">&quot;from&quot;</span>, <span class="at">margin =</span> <span class="st">&quot;Product&quot;</span>)</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a><span class="co">#&gt;       Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a><span class="co">#&gt; Coal             1          2                  3</span></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a><span class="co">#&gt; Solar            4          5                  6</span></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;rowtype&quot;)</span></span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Product&quot;</span></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;coltype&quot;)</span></span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Industry&quot;</span></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a>m_pieces_with_types <span class="sc">%&gt;%</span> </span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>  <span class="fu">rename_to_piece_byname</span>(<span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>, <span class="at">margin =</span> <span class="st">&quot;Product&quot;</span>, <span class="at">choose_most_specific =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a><span class="co">#&gt;       Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a><span class="co">#&gt; Coal             1          2                  3</span></span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a><span class="co">#&gt; Solar            4          5                  6</span></span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;rowtype&quot;)</span></span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Product&quot;</span></span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;coltype&quot;)</span></span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Industry&quot;</span></span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>m_pieces_with_types <span class="sc">%&gt;%</span> </span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a>  <span class="fu">rename_to_piece_byname</span>(<span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>, <span class="at">margin =</span> <span class="st">&quot;Industry&quot;</span>)</span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a><span class="co">#&gt;                          MD MD Light</span></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]   1  2     3</span></span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]  4  5     6</span></span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;rowtype&quot;)</span></span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Product&quot;</span></span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;coltype&quot;)</span></span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Industry&quot;</span></span></code></pre></div>
<p>Such renamings can be used for aggregations in which identically
named rows and columns are summed with <code>aggregate_byname()</code>,
as demonstrated in section below.</p>
</div>
<div id="aggregate_pieces_byname" class="section level2">
<h2><code>aggregate_pieces_byname()</code></h2>
<p><code>aggregate_pieces_byname()</code> bundles renaming and
aggregating tasks in a single function call. First, rows and/or columns
are renamed to the requested <code>piece</code> with the
<code>rename_to_piece_byname()</code> function. Then, aggregation is
performed via <code>aggregate_byname()</code>, according to an
<code>aggregation_map</code> and the <code>pattern_type</code>, if
provided. With the default <code>aggregation_map = NULL</code>,
identically named pieces are aggregated together.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>m_pieces</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt;                          Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]             1          2                  3</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]            4          5                  6</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co"># Aggregate Electricity in rows</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="fu">aggregate_pieces_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;pref&quot;</span>, <span class="at">margin =</span> <span class="dv">1</span>, </span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>                        <span class="at">notation =</span> RCLabels<span class="sc">::</span>bracket_notation)</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt;             Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; Electricity            5          7                  9</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co"># Aggregate useful energy types in columns</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="fu">aggregate_pieces_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>, <span class="at">margin =</span> <span class="dv">2</span>,</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>                        <span class="at">notation =</span> RCLabels<span class="sc">::</span>arrow_notation)</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt;                          Light MD</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]      3  3</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]     6  9</span></span></code></pre></div>
<p>When an <code>aggregation_map</code> is supplied, it applies to the
requested <code>piece</code>, not to the original row and/or column
names, as shown below.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>m_pieces</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt;                          Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]             1          2                  3</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]            4          5                  6</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co"># Aggregate by original energy type</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="fu">aggregate_pieces_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;from&quot;</span>, <span class="at">margin =</span> <span class="dv">1</span>, </span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>                        <span class="at">notation =</span> RCLabels<span class="sc">::</span>bracket_notation, </span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>                        <span class="at">aggregation_map =</span> <span class="fu">list</span>(<span class="st">`</span><span class="at">All sources</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Coal&quot;</span>, <span class="st">&quot;Solar&quot;</span>)))</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt;             Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; All sources            5          7                  9</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="fu">aggregate_pieces_byname</span>(m_pieces, <span class="at">piece =</span> <span class="st">&quot;suff&quot;</span>, <span class="at">margin =</span> <span class="dv">2</span>, </span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>                        <span class="at">notation =</span> RCLabels<span class="sc">::</span>arrow_notation, </span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>                        <span class="at">aggregation_map =</span> <span class="fu">list</span>(<span class="st">`</span><span class="at">Transport</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;MD&quot;</span>))</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt;                          Light Transport</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]      3         3</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]     6         9</span></span></code></pre></div>
</div>
<div id="aggregations-of-lists-and-data-frames-of-matrices" class="section level2">
<h2>Aggregations of lists and data frames of matrices</h2>
<p>The functions for renaming and aggregating can be used on lists and
data frames of matrices.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>m_pieces</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#&gt;                          Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]             1          2                  3</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]            4          5                  6</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rename_to_piece_byname</span>(<span class="fu">list</span>(m_pieces, m_pieces), </span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>                              <span class="at">piece =</span> <span class="fu">list</span>(<span class="st">&quot;pref&quot;</span>, <span class="st">&quot;suff&quot;</span>), </span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>                              <span class="at">margin =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>                              <span class="at">notation =</span> <span class="fu">list</span>(RCLabels<span class="sc">::</span>bracket_notation, </span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>                                              RCLabels<span class="sc">::</span>arrow_notation))</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>res</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt;             Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; Electricity            1          2                  3</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt; Electricity            4          5                  6</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt;                          MD MD Light</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]   1  2     3</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]  4  5     6</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">mats =</span> <span class="fu">list</span>(m_pieces, m_pieces), </span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>                     <span class="at">pce =</span> <span class="fu">list</span>(<span class="st">&quot;suff&quot;</span>, <span class="st">&quot;pref&quot;</span>), </span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>                     <span class="at">mgn =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>                     <span class="at">am =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">Sources =</span> <span class="fu">c</span>(<span class="st">&quot;Coal&quot;</span>, <span class="st">&quot;Solar&quot;</span>)), </span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>                               <span class="fu">list</span>(<span class="at">Transport =</span> <span class="fu">c</span>(<span class="st">&quot;Motors&quot;</span>, <span class="st">&quot;Cars&quot;</span>))), </span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a>                     <span class="at">notn =</span> <span class="fu">list</span>(RCLabels<span class="sc">::</span>from_notation, RCLabels<span class="sc">::</span>arrow_notation))</span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>df</span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="co">#&gt;   mats          pce       mgn       am               notn     </span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;        &lt;list&gt;    &lt;list&gt;    &lt;list&gt;           &lt;list&gt;   </span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="co">#&gt; 1 &lt;dbl [2 × 3]&gt; &lt;chr [1]&gt; &lt;dbl [1]&gt; &lt;named list [1]&gt; &lt;chr [4]&gt;</span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="co">#&gt; 2 &lt;dbl [2 × 3]&gt; &lt;chr [1]&gt; &lt;dbl [1]&gt; &lt;named list [1]&gt; &lt;chr [4]&gt;</span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a>    <span class="at">aggregated =</span> <span class="fu">aggregate_pieces_byname</span>(mats, <span class="at">piece =</span> pce, <span class="at">margin =</span> mgn, </span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a>                                         <span class="at">aggregation_map =</span> am, <span class="at">notation =</span> notn)</span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a>  )</span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a>res2</span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a><span class="co">#&gt;   mats          pce       mgn       am               notn      aggregated   </span></span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;        &lt;list&gt;    &lt;list&gt;    &lt;list&gt;           &lt;list&gt;    &lt;list&gt;       </span></span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a><span class="co">#&gt; 1 &lt;dbl [2 × 3]&gt; &lt;chr [1]&gt; &lt;dbl [1]&gt; &lt;named list [1]&gt; &lt;chr [4]&gt; &lt;dbl [1 × 3]&gt;</span></span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a><span class="co">#&gt; 2 &lt;dbl [2 × 3]&gt; &lt;chr [1]&gt; &lt;dbl [1]&gt; &lt;named list [1]&gt; &lt;chr [4]&gt; &lt;dbl [2 × 2]&gt;</span></span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a>res2<span class="sc">$</span>aggregated[[<span class="dv">1</span>]]</span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a><span class="co">#&gt;         Motors -&gt; MD Cars -&gt; MD LED lamps -&gt; Light</span></span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a><span class="co">#&gt; Sources            5          7                  9</span></span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a>res2<span class="sc">$</span>aggregated[[<span class="dv">2</span>]]</span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a><span class="co">#&gt;                          LED lamps Transport</span></span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a><span class="co">#&gt; Electricity [from Coal]          3         3</span></span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a><span class="co">#&gt; Electricity [from Solar]         6         9</span></span></code></pre></div>
</div>
<div id="aggregation-via-dplyrsummarise" class="section level2">
<h2>Aggregation via <code>dplyr::summarise()</code></h2>
<p>Another type of aggregation is aided by the metadata columns of a
<code>matsindf</code>-style data frame. With single numbers, an
aggregation might look like this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>df_simple <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(<span class="sc">~</span>key, <span class="sc">~</span>val, </span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>                             <span class="st">&quot;A&quot;</span>, <span class="dv">1</span>, </span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>                             <span class="st">&quot;A&quot;</span>, <span class="dv">2</span>, </span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>                             <span class="st">&quot;B&quot;</span>, <span class="dv">10</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>df_simple</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#&gt;   key     val</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt; 1 A         1</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt; 2 A         2</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#&gt; 3 B        10</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>df_simple <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">val =</span> <span class="fu">sum</span>(val))</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt;   key     val</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co">#&gt; 1 A         3</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="co">#&gt; 2 B        10</span></span></code></pre></div>
<p>The same aggregation gives unexpected results with the default
arguments to the <code>sum_byname()</code> function (specifically,
<code>.summarise = FALSE</code>), because <code>sum_byname()</code> is
ambiguous for a data frame. Should the column be returned unchanged,
because each element is interpreted as the augend for a series of sums
that is missing addends, in which case the length of the returned object
is the same as the length of the input? Or should the list of objects be
summed down the column, returning only a single item (for each group),
as in the <code>dplyr::summarise()</code> function? (See the vignette
titled “Using summarise in matsbyname” for additional detail about this
ambiguity.) In the example below, the grouping has no effect on the
<code>summarise()</code> function, because
<code>sum_byname(.summarise = FALSE)</code> assumes that each row of
<code>val</code> is an augend without an addend.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># 2 rows are expected. 3 are observed.</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>df_simple <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">val =</span> <span class="fu">sum_byname</span>(val), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; dplyr 1.1.0.</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `reframe()` instead.</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt;   always returns an ungrouped data frame and adjust accordingly.</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; generated.</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt;   key     val</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt; 1 A         1</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt; 2 A         2</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; 3 B        10</span></span></code></pre></div>
<p>To signal intention to summarise down the <code>val</code> column,
set <code>.summarise = TRUE</code> in the call to
<code>sum_byname()</code>. Note that
<code>sum_byname(.summarise = TRUE)</code> <em>always</em> returns a
list column, because if the summarised column were to contain matrices,
it <em>must</em> be a list column.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> df_simple <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">val =</span> <span class="fu">sum_byname</span>(val, <span class="at">.summarise =</span> <span class="cn">TRUE</span>))</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co"># res$val is a list column.</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>res</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt;   key   val      </span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;   </span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt; 1 A     &lt;dbl [1]&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt; 2 B     &lt;dbl [1]&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>res<span class="sc">$</span>val</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>The <code>.summarise = TRUE</code> argument works when there are
matrices in a <code>matsindf</code> data frame, too.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>,</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>              <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, </span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;r1&quot;</span>, <span class="st">&quot;r2&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;c1&quot;</span>, <span class="st">&quot;c2&quot;</span>, <span class="st">&quot;c3&quot;</span>)))</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">key =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="at">m =</span> <span class="fu">list</span>(m, m, m))</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>unexpected <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">m =</span> <span class="fu">sum_byname</span>(m), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="co">#&gt; Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co">#&gt; dplyr 1.1.0.</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `reframe()` instead.</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt; ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co">#&gt;   always returns an ungrouped data frame and adjust accordingly.</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co">#&gt; generated.</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="co"># 2 rows are expected. 3 are observed.</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>unexpected</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="co">#&gt;   key   m            </span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;       </span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="co">#&gt; 1 A     &lt;dbl [2 × 3]&gt;</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a><span class="co">#&gt; 2 A     &lt;dbl [2 × 3]&gt;</span></span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a><span class="co">#&gt; 3 B     &lt;dbl [2 × 3]&gt;</span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a>res <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">m =</span> <span class="fu">sum_byname</span>(m, <span class="at">.summarise =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a>res</span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a><span class="co">#&gt;   key   m            </span></span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;       </span></span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a><span class="co">#&gt; 1 A     &lt;dbl [2 × 3]&gt;</span></span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a><span class="co">#&gt; 2 B     &lt;dbl [2 × 3]&gt;</span></span>
<span id="cb21-32"><a href="#cb21-32" tabindex="-1"></a>res<span class="sc">$</span>m[[<span class="dv">1</span>]]</span>
<span id="cb21-33"><a href="#cb21-33" tabindex="-1"></a><span class="co">#&gt;    c1 c2 c3</span></span>
<span id="cb21-34"><a href="#cb21-34" tabindex="-1"></a><span class="co">#&gt; r1 22 24 26</span></span>
<span id="cb21-35"><a href="#cb21-35" tabindex="-1"></a><span class="co">#&gt; r2 42 44 46</span></span>
<span id="cb21-36"><a href="#cb21-36" tabindex="-1"></a>res<span class="sc">$</span>m[[<span class="dv">2</span>]]</span>
<span id="cb21-37"><a href="#cb21-37" tabindex="-1"></a><span class="co">#&gt;    c1 c2 c3</span></span>
<span id="cb21-38"><a href="#cb21-38" tabindex="-1"></a><span class="co">#&gt; r1 11 12 13</span></span>
<span id="cb21-39"><a href="#cb21-39" tabindex="-1"></a><span class="co">#&gt; r2 21 22 23</span></span></code></pre></div>
</div>
<div id="working-with-aggregation-maps" class="section level2">
<h2>Working with aggregation maps</h2>
<p>An aggregation map is defined to be a named list. But the source of
that named list is often a data frame in which many-to-one relationships
are defined. <code>agg_table_to_agg_map()</code> assists converting from
a two-column data frame to an aggregation map.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(<span class="sc">~</span>member, <span class="sc">~</span>role, <span class="sc">~</span>band, </span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>                      <span class="st">&quot;John&quot;</span>, <span class="st">&quot;guitarists&quot;</span>, <span class="st">&quot;The Beatles&quot;</span>, </span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>                      <span class="st">&quot;Paul&quot;</span>, <span class="st">&quot;guitarists&quot;</span>, <span class="st">&quot;The Beatles&quot;</span>, </span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>                      <span class="st">&quot;George&quot;</span>, <span class="st">&quot;guitarists&quot;</span>, <span class="st">&quot;The Beatles&quot;</span>, </span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>                      <span class="st">&quot;Ringo&quot;</span>, <span class="st">&quot;drummers&quot;</span>, <span class="st">&quot;The Beatles&quot;</span>, </span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>                      <span class="st">&quot;Mick&quot;</span>, <span class="st">&quot;singers&quot;</span>, <span class="st">&quot;Rolling Stones&quot;</span>, </span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>                      <span class="st">&quot;Keith&quot;</span>, <span class="st">&quot;guitarists&quot;</span>, <span class="st">&quot;Rolling Stones&quot;</span>, </span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>                      <span class="st">&quot;Ronnie&quot;</span>, <span class="st">&quot;guitarists&quot;</span>, <span class="st">&quot;Rolling Stones&quot;</span>, </span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>                      <span class="st">&quot;Bill&quot;</span>, <span class="st">&quot;guitarists&quot;</span>, <span class="st">&quot;Rolling Stones&quot;</span>, </span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>                      <span class="st">&quot;Charlie&quot;</span>, <span class="st">&quot;drummers&quot;</span>, <span class="st">&quot;Rolling Stones&quot;</span>)</span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>df</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 9 × 3</span></span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a><span class="co">#&gt;   member  role       band          </span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;         </span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a><span class="co">#&gt; 1 John    guitarists The Beatles   </span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a><span class="co">#&gt; 2 Paul    guitarists The Beatles   </span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a><span class="co">#&gt; 3 George  guitarists The Beatles   </span></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a><span class="co">#&gt; 4 Ringo   drummers   The Beatles   </span></span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a><span class="co">#&gt; 5 Mick    singers    Rolling Stones</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a><span class="co">#&gt; 6 Keith   guitarists Rolling Stones</span></span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a><span class="co">#&gt; 7 Ronnie  guitarists Rolling Stones</span></span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a><span class="co">#&gt; 8 Bill    guitarists Rolling Stones</span></span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a><span class="co">#&gt; 9 Charlie drummers   Rolling Stones</span></span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a>bands_membs_agg_map <span class="ot">&lt;-</span> <span class="fu">agg_table_to_agg_map</span>(df, <span class="at">few_colname =</span> <span class="st">&quot;band&quot;</span>, <span class="at">many_colname =</span> <span class="st">&quot;member&quot;</span>)</span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a>bands_membs_agg_map</span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a><span class="co">#&gt; $`Rolling Stones`</span></span>
<span id="cb22-27"><a href="#cb22-27" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Mick&quot;    &quot;Keith&quot;   &quot;Ronnie&quot;  &quot;Bill&quot;    &quot;Charlie&quot;</span></span>
<span id="cb22-28"><a href="#cb22-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-29"><a href="#cb22-29" tabindex="-1"></a><span class="co">#&gt; $`The Beatles`</span></span>
<span id="cb22-30"><a href="#cb22-30" tabindex="-1"></a><span class="co">#&gt; [1] &quot;John&quot;   &quot;Paul&quot;   &quot;George&quot; &quot;Ringo&quot;</span></span>
<span id="cb22-31"><a href="#cb22-31" tabindex="-1"></a><span class="fu">agg_table_to_agg_map</span>(df, <span class="at">few_colname =</span> <span class="st">&quot;role&quot;</span>, <span class="at">many_colname =</span> <span class="st">&quot;member&quot;</span>)</span>
<span id="cb22-32"><a href="#cb22-32" tabindex="-1"></a><span class="co">#&gt; $drummers</span></span>
<span id="cb22-33"><a href="#cb22-33" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Ringo&quot;   &quot;Charlie&quot;</span></span>
<span id="cb22-34"><a href="#cb22-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-35"><a href="#cb22-35" tabindex="-1"></a><span class="co">#&gt; $guitarists</span></span>
<span id="cb22-36"><a href="#cb22-36" tabindex="-1"></a><span class="co">#&gt; [1] &quot;John&quot;   &quot;Paul&quot;   &quot;George&quot; &quot;Keith&quot;  &quot;Ronnie&quot; &quot;Bill&quot;  </span></span>
<span id="cb22-37"><a href="#cb22-37" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-38"><a href="#cb22-38" tabindex="-1"></a><span class="co">#&gt; $singers</span></span>
<span id="cb22-39"><a href="#cb22-39" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Mick&quot;</span></span></code></pre></div>
<p>In a similar manner, an aggregation map can be converted to a data
frame to assist with join operations with data frames.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">agg_map_to_agg_table</span>(bands_membs_agg_map, </span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>                      <span class="at">few_colname =</span> <span class="st">&quot;bands&quot;</span>,</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>                      <span class="at">many_colname =</span> <span class="st">&quot;members&quot;</span>)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 9 × 2</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">#&gt;   bands          members</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt;  </span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co">#&gt; 1 Rolling Stones Mick   </span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="co">#&gt; 2 Rolling Stones Keith  </span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co">#&gt; 3 Rolling Stones Ronnie </span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt; 4 Rolling Stones Bill   </span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt; 5 Rolling Stones Charlie</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="co">#&gt; 6 The Beatles    John   </span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="co">#&gt; 7 The Beatles    Paul   </span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a><span class="co">#&gt; 8 The Beatles    George </span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="co">#&gt; 9 The Beatles    Ringo</span></span></code></pre></div>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>The <code>matsbyname</code> package simplifies aggregation of matrix
rows and columns based on row and column names or pieces of row and
column names. In particular the functions
<code>aggregate_byname()</code>, <code>rename_to_piece_byname()</code>,
and <code>aggregate_pieces_byname()</code> provide flexibility in how
renaming and aggregation can be accomplished. When working with
aggregation maps, the functions <code>agg_table_to_agg_map()</code> and
<code>agg_map_to_agg_table()</code> assist conversion from one data
shape to another.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
